# Fetching Configurations

# ==================================================================== 
# ===== World Bank Settings =====
# ====================================================================
worldbank: # name must be same as in client_factory.py

  # Inclusive start/end year for the World Bank "date" filter, e.g. date=2010:2024
  # Not all indicators have values for every year; nulls are expected.
  start_year: 2010
  end_year: 2024

  api_paths: 
    # Base URL for World Bank API
    base: "https://api.worldbank.org/v2"
    # Indicator endpoint
    indicator_endpoint: "/country/{country_str}/indicator/{indicator_code}"

  # Indicators to fetch. "code" is the official WB indicator id;
  # "alias" is the clean, BI-friendly name used in outputs ("indicator" column).
  indicators:
    # Population density (people per sq. km of land area)
    # See: https://data.worldbank.org/indicator/EN.POP.DNST
    - { code: "EN.POP.DNST", alias: "population_density_per_sq_km" }  

  # ISO-3 country codes to query in ONE request (semicolon-joined in the API call).
  # You can add/remove codes (e.g., "GBR", "FRA"). Regions like "WLD" (world) also work,
  # but mixing countries + regions may complicate modeling/visuals later.
  # countries: ["CAN", "USA", "MEX", "IND", "CHN", "NGA", "BRA"]
  countries: ["all"]

  # # EXTRA INDICATORS (uncomment as needed)
  # - { code: "NY.GDP.PCAP.CD", alias: "gdp_per_capita_usd" }           # GDP per capita (current US$)
  # - { code: "GC.TAX.TOTL.GD.ZS", alias: "tax_revenue_pct_gdp" }       # Tax revenue (% of GDP)
  # - { code: "FS.AST.PRVT.GD.ZS", alias: "domestic_credit_private_pct_gdp" } # Domestic credit to private sector (% of GDP)


# ==================================================================== 
# ===== UN SDG Settings =====
# ====================================================================
unsdg: # name must be same as in client_factory.py

  # Inclusive start/end year for UN SDG data fetching
  start_year: 2010
  end_year: 2024

  api_paths: 
    # Base URL for UN SDG API
    base: "https://unstats.un.org/sdgs/UNSDGAPIV5/v1/sdg"
    # Indicator endpoints
    indicator_list_endpoint: "/Indicator/List"
    indicator_data_endpoint: "/Indicator/Data"

  indicators:
    # === SECTOR 1: HEALTHCARE ===
    # === HEALTHCARE ===
    # Resilient Primary Healthcare (PHC) systems
    - { code: "3.8.1", alias: "coverage_of_essential_health_services" }
    # Infectious disease control
    - { code: "3.3.2", alias: "tuberculosis_incidence_per_100000_population" }
    - { code: "3.3.3", alias: "incidence_of_malaria" }
    # Maternal and child health
    - { code: "3.1.1", alias: "maternal_mortality_ratio" }
    - { code: "3.2.1", alias: "under_5_mortality_ratio" }
    # Nutrition
    - { code: "2.2.1", alias: "prevalence_of_stunting" }
    - { code: "2.2.2", alias: "prevalence_of_malnutrition" }
    - { code: "2.2.3", alias: "prevalence_of_anemia_in_women_aged_15_to_49_years" }
    # Reproductive health and family planning
    - { code: "3.7.1", alias: "portion_of_women_of_reproductive_age_with_family_planning_needs_met" }
    - { code: "3.7.2", alias: "adolescent_birth_rate_age_15_to_19_years_per_1000_women_in_that_age_group" }
    # Health risk reduction and management
    - { code: "3.d.1", alias: "international_health_regs_capacity_and_health_emergency_preparedness" }
 
    # === AGRICULTURE ===
    # Food security
    - { code: "2.1.2", alias: "prevalence_of_moderate_severe_food_insecurity_in_pop_based_on_FIES" }
    - { code: "2.4.1", alias: "proportion_of_agricultural_area_under_productive_and_sustainable_agriculture" }
    # Agricultural systems and value chain strengthening
    - { code: "2.a.2", alias: "total_agricultural_flows_to_the_agriculture_sector" }

    # === SOCIAL INFRASTRUCTURE ===
    # Water, sanitation, and hygiene (WASH)
    - { code: "6.1.1", alias: "proportion_of_population_using_safely_managed_drinking_water_services" }
    - { code: "6.2.1", alias: "proportion_of_population_not_using_safely_managed_sanitation_services" }
    - { code: "3.9.2", alias: "mortality_rate_attributable_to_household_and_ambient_air_pollution" }
    # Off-grid power
    - { code: "7.1.1", alias: "proportion_of_population_with_access_to_electricity" }
    - { code: "7.1.2", alias: "proportion_of_population_with_primary_reliance_on_clean_fuels_and_technology" }
    - { code: "7.2.1", alias: "renewable_energy_share_in_total_final_energy_consumption" }
    # Digital financial inclusion
    - { code: "8.10.2", alias: "proportion_of_adults_15_or_older_with_account_at_a_financial_institution_or_with_a_mobile_money_service_provider" }
  
    # === ADDITIONAL CONSIDERATIONS ===
    - { code: "1.2.1", alias: "proportion_of_population_below_the_international_poverty_line" }

  # FetchHandler settings for robust autonomous retry handling
  settings:
    request_timeout: 90           # Request timeout in seconds (UN SDG API is slow)
    max_retries: 10               # Max retry attempts per request before giving up
    initial_backoff: 2.0          # Initial backoff in seconds
    max_backoff: 180.0            # Maximum backoff cap (3 minutes)
    backoff_multiplier: 2.0       # Exponential backoff multiplier (2s -> 4s -> 8s -> ...)
    delay_between_requests: 0.75  # Delay between successful requests (reduces server load)


# ==================================================================== 
# ===== ND-GAIN Settings =====
# ====================================================================
ndgain: # name must be same as in client_factory.py

  zip_path: 
    # Base path of the ND-GAIN ZIP file
    base: data/external/nd_gain_countryindex_2025.zip

  # Indicator prefixes as they are in the ND-GAIN ZIP file for identifying score files by indicator
  indicators:
    # Indicators for constructing a country's Vulnerability index
    # Ecosystem Services, Food, Human Habitat, Health, Infrastructure, Water
    vulnerability: ['id_ecos', 'id_food', 'id_habi', 'id_heal', 'id_infr', 'id_wate']
    # Indicators for constructing a country's Readiness index
    # Government, Economic, Social
    readiness: ['id_gove', 'id_econ', 'id_soci']

  settings:
    request_timeout: 30  # in seconds
    max_retries: 3
    retry_backoff_factor: 0.3


# ==================================================================== 
# ===== General Settings =====
# ====================================================================
paths:
  # FOR DEBUGGING: Where to store raw data locally
  data_raw: "data/raw/"

  # Where to store cleaned, interim data
  data_interim: "data/interim/"

  # Where to store polished, model-ready or Power BI–ready outputs (optional).
  data_processed: "data/processed/"

runtime:

  # Save raw data locally?
  save_raw: true

  # Save cleaned data locally?
  save_cleaned: true

  # If true: save data to Azure Blob Storage (paths above).
  upload_azure: false # """ <-- @ANTHONY change to true to verify azure upload works"""

  # Path of where cleaned interim data is stored locally
  interim_data:
    unsdg: "data/interim/un_sdg_interim.csv"
    ndgain: "data/interim/nd_gain_interim.csv"
    worldbank: "data/interim/world_bank_interim.csv"

  # Page size for World Bank API pagination. 1000 is a good max that reduces round-trips.
  # The client will auto-paginate until all pages are fetched.
  per_page: 1000

  # Number of lines to read per file chunk
  chunk_size: 10000

  # Maximum number of retry attempts for transient network/server errors
  # during API calls. Used with exponential backoff to improve resilience.
  #
  # How it works (with tenacity/backoff in code):
  # 1) Attempt the request.
  # 2) If it fails with a retryable error (timeout, 5xx, connection reset), wait a short time.
  # 3) Try again, increasing the wait (exponential backoff) until attempts == max_retries.
  #
  # Practical guidance:
  # - Keep 3–5 in most environments.
  # - Increase if your network is flaky or if the WB API rate-limits/briefly blips.
  # - Decrease in CI if you want faster failures.
  max_retries: 4

