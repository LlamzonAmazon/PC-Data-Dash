# Fetching Configurations

# ==================================================================== 
# ===== World Bank Settings =====
# ====================================================================
worldbank: # name must be same as in client_factory.py

  # Inclusive start/end year for the World Bank "date" filter, e.g. date=2010:2024
  # Not all indicators have values for every year; nulls are expected.
  start_year: 2010
  end_year: 2024

  api_paths: 
    # Base URL for World Bank API
    base: "https://api.worldbank.org/v2"
    # Indicator endpoint
    indicator_endpoint: "/country/{country_str}/indicator/{indicator_code}"

  # Indicators to fetch. "code" is the official WB indicator id;
  # "alias" is the clean, BI-friendly name used in outputs ("indicator" column).
  indicators:
    # Population density (people per sq. km of land area)
    # See: https://data.worldbank.org/indicator/EN.POP.DNST
    - { code: "EN.POP.DNST", alias: "population_density_per_sq_km" }  

  # ISO-3 country codes to query in ONE request (semicolon-joined in the API call).
  # You can add/remove codes (e.g., "GBR", "FRA"). Regions like "WLD" (world) also work,
  # but mixing countries + regions may complicate modeling/visuals later.
  countries: ["CAN", "USA", "MEX", "IND", "CHN", "NGA", "BRA"]

    # EXTRA INDICATORS (uncomment as needed)
    # - { code: "NY.GDP.PCAP.CD", alias: "gdp_per_capita_usd" }           # GDP per capita (current US$)
    # - { code: "GC.TAX.TOTL.GD.ZS", alias: "tax_revenue_pct_gdp" }       # Tax revenue (% of GDP)
    # - { code: "FS.AST.PRVT.GD.ZS", alias: "domestic_credit_private_pct_gdp" } # Domestic credit to private sector (% of GDP)


# ==================================================================== 
# ===== UN SDG Settings =====
# ====================================================================
unsdg: # name must be same as in client_factory.py

  # Inclusive start/end year for UN SDG data fetching
  start_year: 2010
  end_year: 2024

  api_paths: 
    # Base URL for UN SDG API
    base: "https://unstats.un.org/sdgs/UNSDGAPIV5/v1/sdg"
    # Indicator endpoints
    indicator_list_endpoint: "/Indicator/List"
    indicator_data_endpoint: "/Indicator/Data"

  indicators:
    # === HEALTHCARE ===
    # Resilient Primary Healthcare (PHC) systems
    - { code: "3.8.1", alias: "coverage_of_essential_health_services" }
    # Infectious disease control
    - { code: "3.3.2", alias: "tuberculosis_incidence_per_100000_population" }
    - { code: "3.3.3", alias: "incidence_of_malaria" }
    # Maternal and child health
    - { code: "3.1.1", alias: "maternal_mortality_ratio" }
    - { code: "3.2.1", alias: "under_5_mortality_ratio" }
    # Nutrition
    - { code: "2.2.1", alias: "prevalence_of_stunting" }
    - { code: "2.2.2", alias: "prevalence_of_malnutrition" }
    - { code: "2.2.3", alias: "prevalence_of_anemia_in_women_aged_15_to_49_years" }
    # Reproductive health and family planning
    - { code: "3.7.1", alias: "portion_of_women_of_reproductive_age_with_family_planning_needs_met" }
    - { code: "3.7.2", alias: "adolescent_birth_rate_age_15_to_19_years_per_1000_women_in_that_age_group" }
    # Health risk reduction and management
    - { code: "3.d.1", alias: "international_health_regs_capacity_and_health_emergency_preparedness" }
 
    # === AGRICULTURE ===
    # Food security
    - { code: "2.1.2", alias: "prevalence_of_moderate_severe_food_insecurity_in_pop_based_on_FIES" }
    - { code: "2.4.1", alias: "proportion_of_agricultural_area_under_productive_and_sustainable_agriculture" }
    # Agricultural systems and value chain strengthening
    - { code: "2.a.2", alias: "total_agricultural_flows_to_the_agriculture_sector" }

    # === SOCIAL INFRASTRUCTURE ===
    # Water, sanitation, and hygiene (WASH)
    - { code: "6.1.1", alias: "proportion_of_population_using_safely_managed_drinking_water_services" }
    - { code: "6.2.1", alias: "proportion_of_population_not_using_safely_managed_sanitation_services" }
    - { code: "3.9.2", alias: "mortality_rate_attributable_to_household_and_ambient_air_pollution" }
    # Off-grid power
    - { code: "7.1.1", alias: "proportion_of_population_with_access_to_electricity" }
    - { code: "7.1.2", alias: "proportion_of_population_with_primary_reliance_on_clean_fuels_and_technology" }
    - { code: "7.2.1", alias: "renewable_energy_share_in_total_final_energy_consumption" }
    # Digital financial inclusion
    - { code: "8.10.2", alias: "proportion_of_adults_15_or_older_with_account_at_a_financial_institution_or_with_a_mobile_money_service_provider" }
  
    # === ADDITIONAL CONSIDERATIONS ===
    - { code: "1.2.1", alias: "proportion_of_population_below_the_international_poverty_line" }

  settings:
    request_timeout: 30  # in seconds
    max_retries: 3
    retry_backoff_factor: 0.3


# ==================================================================== 
# ===== ND-GAIN Settings =====
# ====================================================================
ndgain: # name must be same as in client_factory.py

  zip_path: 
    # Base path of the ND-GAIN ZIP file
    base: data/external/nd_gain_countryindex_2025.zip

  # Indicator prefixes as they are in the ND-GAIN ZIP file for identifying score files by indicator
  indicators:
    # Indicators for constructing a country's Vulnerability index
    # Ecosystem Services, Food, Human Habitat, Health, Infrastructure, Water
    vulnerability: ['id_ecos', 'id_food', 'id_habi', 'id_heal', 'id_infr', 'id_wate']
    # Indicators for constructing a country's Readiness index
    # Government, Economic, Social
    readiness: ['id_gove', 'id_econ', 'id_soci']

  settings:
    request_timeout: 30  # in seconds
    max_retries: 3
    retry_backoff_factor: 0.3


# ==================================================================== 
# ===== General Settings =====
# ====================================================================
paths:
  # Where to store raw, untouched API JSON for auditability and re-processing.
  data_raw: "data/raw/world_bank"

  # Where to store cleaned “tidy” data produced by the fetch step (still general-purpose).
  data_interim: "data/interim/world_bank"

  # Where to store polished, model-ready or Power BI–ready outputs (optional).
  data_processed: "data/processed/world_bank"

  # Main combined tidy CSV (columns: country, iso3, indicator, year, value).
  # This is what Power BI or downstream transforms might ingest. (possibly during development)
  wb_interim_csv: "data/interim/world_bank/world_bank_interim.csv"
  unsdg_interim_csv: "data/interim/un_sdg/un_sdg_interim.csv"
  ndgain_interim_csv: "data/interim/ndgain/ndgain_interim.csv"

runtime:
  # If true: write raw JSON and the interim CSV to disk (paths above).
  # If false: only print a console preview (useful for quick testing).
  write_files: true

  # Page size for World Bank API pagination. 1000 is a good max that reduces round-trips.
  # The client will auto-paginate until all pages are fetched.
  per_page: 1000

  # Number of lines to read per file chunk
  chunk_size: 10000

  # Maximum number of retry attempts for transient network/server errors
  # during API calls. Used with exponential backoff to improve resilience.
  #
  # How it works (with tenacity/backoff in code):
  # 1) Attempt the request.
  # 2) If it fails with a retryable error (timeout, 5xx, connection reset), wait a short time.
  # 3) Try again, increasing the wait (exponential backoff) until attempts == max_retries.
  #
  # Practical guidance:
  # - Keep 3–5 in most environments.
  # - Increase if your network is flaky or if the WB API rate-limits/briefly blips.
  # - Decrease in CI if you want faster failures.
  max_retries: 4

